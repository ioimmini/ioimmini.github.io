---
emoji: Â ğŸ’
title: 'ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¡œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ í•˜ê¸°'
date: '2024-07-24'
categories: issue
---

---

> ### ğŸ™Œ **ì†Œê°œ**

ì»¤ë®¤ë‹ˆí‹° ê¸€, ëŒ“ê¸€ ë° ë‹µê¸€ ìˆ˜ì • ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë˜ ì¤‘ì— ëŒ“ê¸€ì„ mutationìœ¼ë¡œ ëŒ“ê¸€ì„ ìˆ˜ì •ì²˜ë¦¬í•œ ë’¤ ì¿¼ë¦¬ë¥¼ invalidateí•˜ë©´ ë‹¤ì‹œ refetchê°€ ì´ë£¨ì–´ì§€ëŠ” ë°ì— ì‹œê°„ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸ì—, í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„ ì ì‹œ ìˆ˜ì • ì „ì˜ ëŒ“ê¸€ì´ í‘œì‹œë˜ë‹¤ê°€ 0.5ì´ˆì¯¤ í›„ ìˆ˜ì •ëœ ëŒ“ê¸€ì´ í‘œì‹œë˜ëŠ” í˜„ìƒì´ ìƒê¸°ëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ê²½í—˜ì„ ìœ„í•´ ëŒ“/ë‹µê¸€ ìˆ˜ì •ì— ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ì ìš©ì‹œí‚¤ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤!

> ### âœ”ï¸ **Optimistic Update (ë‚™ê´€ì  ì—…ë°ì´íŠ¸)ì´ ë¬´ì—‡ì¼ê¹Œ**

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ëŠ” ì„œë²„ì˜ ì„±ê³µ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´, í•´ë‹¹ ì„œë²„ì˜ í†µì‹ ì´ **ì„±ê³µí–ˆë‹¤ê³  ê°€ì •**í•˜ê³  UIë¥¼ **ë¯¸ë¦¬ ì—…ë°ì´íŠ¸**í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ ì‚¬ìš©ìì—ê²Œ **ë¹ ë¥¸ í”¼ë“œë°±**ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ ê²Œì‹œë¬¼ ì¢‹ì•„ìš”, íŒ”ë¡œìš° ìš”ì²­ ë“± ì‹¤ì‹œê°„ìœ¼ë¡œ ìœ ì € í”¼ë“œë°±ì´ í•„ìš”í•œ ê²½ìš°ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ì‹¤ì œ ì„œë²„ì™€ì˜ ë™ê¸°í™”ëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì´ë£¨ì–´ì§€ë©°, ì„±ê³µ ì‹œ UI ë³€ê²½ì´ í™•ì •ë˜ê³ , ì‹¤íŒ¨ ì‹œ ì´ˆê¸° ìƒíƒœë¡œ ë¡¤ë°±ë©ë‹ˆë‹¤.

React Queryì—ì„œëŠ” `post, patch, put, delete` ìš”ì²­ì„ `mutation` ê¸°ëŠ¥ì„ í†µí•´ ì²˜ë¦¬í•˜ë©°, ì´ë¥¼ í†µí•´ ì‰½ê²Œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ### ğŸ—’ï¸ **ìˆ˜ì •ì½”ë“œ**

**Tanstack Queryì˜ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì—¬ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.**

```
const updateCommentMut = useMutation({
		mutationFn: async ({ commentId, content }: { commentId: number; content: string }) => {
			const supabase = createClient();
			const { error } = await supabase
				.from('post_comments')
				.update({ content })
				.eq('id', commentId);
			if (error) {
				throw error;
			}
		},
		onMutate: async ({ commentId, content }) => {
			await queryClient.cancelQueries({ queryKey: ['comments', postId] });

			const previousComments = queryClient.getQueryData<{ comments: CommentWithReplies[]; anonyIndexMap: Map<number, number>; }>(['comments', postId]);

			if (!previousComments) return;

			const updatedComments = {
				...previousComments,
				comments: previousComments.comments.map((comment) => {
					if (comment.id === commentId) {
						return { ...comment, content };
					}
					return comment;
				}),
			};

			queryClient.setQueryData(['comments', postId], updatedComments);

			return { previousComments };
		},
		onError: (err, newComment, context) => {
			if (context?.previousComments) {
				queryClient.setQueryData(['comments', postId], context.previousComments);
			}
			toast.error('ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
		},
		onSettled: () => {
			queryClient.invalidateQueries({ queryKey: ['comments', postId] });
			setEditingCommentId(null);
		},
	});
```

> ### **ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ì „ vs í›„ ì°¨ì´ ë³´ì‹œì£ **

![](optimistic_updatesì „.gif)
![](optimistic_updatesí›„.gif)

> ### ğŸ”† **ê²°ë¡ **

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ëŠ” ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ê°€ **ì¦‰ê°ì ìœ¼ë¡œ ë°˜ì‘**í•˜ë¯€ë¡œ ì‚¬ìš©ì ê²½í—˜ì´ í–¥ìƒë  ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë°ì´í„° ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±ì´ ë°œìƒí•˜ëŠ” ê²½ìš°ì—ëŠ” ì‚¬ìš©ìì—ê²Œ **ì‹ ë¢°ë„ë¥¼ ë‚®ì¶”ëŠ” ë‹¨ì **ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, SNSì—ì„œ ì‚¬ìš©ìê°€ ê²Œì‹œë¬¼ì— `ì¢‹ì•„ìš”`ë¥¼ ëˆ„ë¥¼ ë•Œ ì‹œìŠ¤í…œì€ ì¦‰ì‹œ í•´ë‹¹ `ì¢‹ì•„ìš”` ë²„íŠ¼ì˜ ìƒíƒœë¥¼ ë³€ê²½í•˜ê³  `ì¢‹ì•„ìš”` ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤. ë™ì‹œì— ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ ì‹¤ì œë¡œ `ì¢‹ì•„ìš”`ê°€ ì €ì¥ë©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì¦‰ì‹œ `ì¢‹ì•„ìš”`ê°€ ë°˜ì˜ë˜ëŠ” ê²ƒì„ ë³´ê³  ì‹œìŠ¤í…œì´ ë¹ ë¥´ê³  ë°˜ì‘ì ì´ë¼ê³  ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ ì„œë²„ ë¬¸ì œë¡œ ì¸í•´ `ì¢‹ì•„ìš”`ê°€ ì €ì¥ë˜ì§€ ì•Šìœ¼ë©´ ì‚¬ìš©ìê°€ ë³¸ ì •ë³´ì™€ ì‹¤ì œ ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.

**ì¢‹ì•„ìš”**ì™€ ê°™ì´ ì‚¬ìš©ì ê²½í—˜ì´ ì¤‘ìš”í•˜ê³ , ë°ì´í„° ë¶ˆì¼ì¹˜ê°€ í° ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠëŠ” ì„œë¹„ìŠ¤ëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì‚¬ìš©ìì˜ ë§Œì¡±ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ **ê¸ˆìœµ ê±°ë˜ ì„œë¹„ìŠ¤, ì˜ë£Œ ê¸°ë¡ ê´€ë¦¬, ì˜ˆì•½ ì‹œìŠ¤í…œ ë“± ë†’ì€ ì‹ ë¢°ì„±ê³¼ ì •í™•ì„±ì„ ìš”êµ¬í•˜ëŠ” ì„œë¹„ìŠ¤ì—**ì„œëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ëŒ€ì‹  í™•ì¸ëœ í›„ ì—…ë°ì´íŠ¸ë¥¼ ë°˜ì˜í•˜ëŠ” ë°©ì‹ì´ ì ì ˆí•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ì‹ì€ **ì‚¬ìš©ìì—ê²Œ ì˜ëª»ëœ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì‹¬ê°í•œ ë¬¸ì œë¥¼ ì˜ˆë°©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ### ğŸ”¥ **ì°¸ê³ **

[Tanstack ê³µì‹ë¬¸ì„œ](https://tanstack.com/query/latest/docs/framework/react/guides/optimistic-updates)
